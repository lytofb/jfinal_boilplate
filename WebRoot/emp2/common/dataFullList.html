<#include "/emp2/common/_layout.html"/>
<@css>

  <link href="${base_path}/emp2/js/advanced-datatable/css/demo_page.css" rel="stylesheet">
  <link href="${base_path}/emp2/js/advanced-datatable/css/demo_table.css" rel="stylesheet">
 <link href="${base_path}/emp2/js/data-tables/DT_bootstrap.css" rel="stylesheet"> 
  
</@css>
<@layout>
       
        <!-- page heading start-->
        <div class="page-heading">
            <h3>
                &nbsp;&nbsp;商品列表
            </h3>
            <!-- qgy 
            <ul class="breadcrumb">
                <li>
                    <a href="#">Dashboard</a>
                </li>
                <li>
                    <a href="#">Data Tables</a>
                </li>
                <li class="active"> Dynamic Table </li>
            </ul>
            -->
        </div>
        <!-- page heading end-->

        <!--body wrapper start-->
        <div class="wrapper">
        <div class="row">
        <div class="col-sm-12">
        <section class="panel">
        <!--  
        <header class="panel-heading">
            DataTables hidden row details example
            <span class="tools pull-right">
                <a href="javascript:;" class="fa fa-chevron-down"></a>
                <a href="javascript:;" class="fa fa-times"></a>
             </span>
        </header>
         -->
        <div class="panel-body">
        <div class="adv-table">
        <table class="display table table-bordered" id="hidden-table-info">
        <thead>
        <tr id="tableTheadTemplateTarget">
            <th>Rendering engine</th>
            <th>Browser</th>
            <th class="hidden-phone">Platform(s)</th>
            <th class="hidden-phone">Engine version</th>
            <th class="hidden-phone">CSS grade</th>
            <th class="hidden-phone">CSS grade</th>
        </tr>
        </thead>
        <tbody id="tableTdTemplateTarget">
        <tr class="gradeX">
            <td>Trident</td>
            <td>Internet
                Explorer 4.0</td>
            <td class="hidden-phone">Win 95+</td>
            <td class="center hidden-phone">4</td>
            <td class="center hidden-phone">X</td>
            <td class="center hidden-phone">X</td>
        </tr>
        </tbody>
        </table>

        </div>
        </div>
        </section>
        </div>
        </div>
        </div>
        <!--body wrapper end-->

<!--         footer section start
        <footer>
            2014 &copy; AdminEx by ThemeBucket
        </footer>
        footer section end -->

</section>
</@layout> 
<@script>
    <#include "/emp2/saleForce/tableComp.html"/>
    <script src="${base_path}/emp2/js/jsrender.js" type="text/javascript"></script>
    <script src="${base_path}/js/layer/layer.js" type="text/javascript"></script>
    <script type="text/javascript">
        var schema_data = {};
        var form_data = [];
        var meta_data = [];
        var initSchema = function () {
            var url = '${base_path}/eco/getSchema';
            var fun = function (data) {
                meta_data = [];
                schema_data =data.schema_list[0];
                $.each(schema_data.data.groupdata, function(index, val) {
                     meta_data.push({'displayname':val.displayname});
                });
                $.each(schema_data.data.numberdata, function(index, val) {
                     meta_data.push({'displayname':val.displayname});
                });
                //queryForForm(schema_data);
            };
            var errfun = function () {};
            var datatype = 'json';
            var data = {'userId':${userid},'token':1};
            commonPost(url,fun,errfun,datatype,data);
        }

        var queryForForm = function (schema_data) {
            var url = '${base_path}/eco/getFormData';
            var fun = function (data) {
                form_data = data;
                renderTable(form_data,meta_data);
                initDynamicTable();
                // layer.closeAll('loading');
            }
            var errfun = function (data) {

            }
            var datatype = 'json';
            var data = {'userId':${userid},'token':1};
            var extcolumn = {'extcolumn':'a','columnoptions':['aa','bb']};
            $.each(schema_data.data.groupdata, function(index, val) {
                delete val.optionalItems
            });
            data.data = JSON.stringify(schema_data.data);
            data.schemaid = schema_data.schemaid;
            data.extcolumn = JSON.stringify(extcolumn);
            commonPost(url,fun,errfun,datatype,data);            
        }

        var renderTable = function (form_data,meta_data) {
            $( "#tableTdTemplateTarget" ).html(
                $( "#tableTdTemplate" ).render( form_data )
            );

            $( "#tableTheadTemplateTarget" ).html(
                $( "#tableTheadTemplate" ).render( meta_data )
            );

        }
       
        function commonPost(url,fun,errfun,datatype,data,async){
          if (!datatype) {
            datatype="text"
          };
          if (!async) {
            async = false;
          };
          $.ajax({
              url:url,
              dataType:datatype,
              async:async,
              type: "POST",
              success:fun,
              data:data
          }).fail(
              errfun
          )
        }
        $(document).ready(function() {
            // layer.load(2);
            $(document).ajaxError(function(event, xhr, settings, thrownError) {
                /* Stuff to do when an AJAX call returns an error */;
                if(xhr.status === 401){
                    location.href="${base_path}/"
                }
            });
            initSchema();
        } );
    </script>
	<script type="text/javascript"
		src="${base_path}/emp2/js/advanced-datatable/js/jquery.dataTables.js"></script>
	<script type="text/javascript"
		src="${base_path}/emp2/js/data-tables/DT_bootstrap.js"></script>
	<script type="text/javascript"
		src="${base_path}/emp2/js/dynamic_table_init.js"></script>
</@script>